<div style="display:flex; gap:20px; height:100%;">
    <div style="flex:2; display:flex; flex-direction:column;">
        <div style="color:#64ffda; font-weight:bold; margin-bottom:10px;">ğŸ’¬ Ú©Ø§Ù†Ø§Ù„ Ø¯ÛŒÙ¾Ù„Ù…Ø§ØªÛŒÚ©</div>
        <div id="unChatMessages" style="flex:1; overflow-y:auto; background:rgba(0,0,0,0.3); border-radius:16px; padding:10px; font-size:13px; margin-bottom:10px;"></div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="unChatInput" placeholder="Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯Ø§Ù†..." style="flex:1; background:#1e293b; border:1px solid #3b82f6; border-radius:40px; padding:8px 16px; color:white;">
            <button onclick="sendUnChat()" style="background:#3b82f6; border:none; border-radius:40px; padding:8px 20px; color:white; cursor:pointer;">Ø§Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
    <div style="flex:1; background:rgba(20,30,50,0.6); border-radius:24px; padding:15px;">
        <div style="color:#64ffda; font-weight:bold; margin-bottom:10px;">ğŸŒ Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ Ø¹Ø¶Ùˆ</div>
        <div id="unCountriesList" style="overflow-y:auto; max-height:400px;"></div>
    </div>
</div>

<script>
// ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ú©Ø´ÙˆØ±Ù‡Ø§ (Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² serverState.globalOwnership Ùˆ countriesGeo)
function refreshUnCountriesList() {
    let listDiv = document.getElementById('unCountriesList');
    if (!listDiv) return;
    let html = '';
    // Ø§Ø² Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ countriesGeo Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ú©Ù‡ Ø¯Ø± index.html ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡)
    let sortedCountries = Object.keys(window.countriesGeo || {}).sort((a,b)=>a.localeCompare(b));
    for (let country of sortedCountries) {
        let owner = window.serverState?.globalOwnership[country] || null;
        let ownerName = owner ? owner : 'Ø¢Ø²Ø§Ø¯';
        let online = owner && Object.values(window.serverState?.onlinePlayers || {}).some(p => p.name === owner && p.online);
        let statusClass = online ? 'online-status' : 'offline-status';
        let onclick = owner && online ? `openPrivateChat('${owner}')` : '';
        html += `<div class="country-item" ${onclick ? 'onclick="' + onclick + '"' : ''} style="display:flex; align-items:center; gap:8px; padding:8px; border-radius:30px; cursor:pointer; margin-bottom:4px; border:1px solid transparent;">
            <span class="country-status ${statusClass}" style="width:8px; height:8px; border-radius:50%; background:${online ? '#22c55e' : '#6b7280'}; box-shadow:${online ? '0 0 8px #22c55e' : 'none'};"></span>
            <span style="flex:1;">${country}</span>
            <span style="color:#fbbf24; font-size:11px;">(${ownerName})</span>
        </div>`;
    }
    listDiv.innerHTML = html;
}

// ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú†Øª Ø¹Ù…ÙˆÙ…ÛŒ (Ø§Ø² Ø·Ø±ÛŒÙ‚ socket)
function sendUnChat() {
    let input = document.getElementById('unChatInput');
    let msg = input.value.trim();
    if (msg && window.socket) {
        window.socket.emit('chat_message', { message: msg, country: window.gameState?.myCountry || 'Ø³Ø§Ø²Ù…Ø§Ù† Ù…Ù„Ù„' });
        input.value = '';
    }
}

// Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú†Øª Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø§ÛŒÙ† ØªØ¨ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
if (window.socket) {
    window.socket.on('chat_message', function(data) {
        let chat = document.getElementById('unChatMessages');
        if (!chat) return;
        let time = new Date(data.time).toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
        chat.innerHTML += `<div><b>${data.country || data.name}:</b> ${data.message} <span style="color:#94a3b8;">${time}</span></div>`;
        chat.scrollTop = chat.scrollHeight;
    });
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù„ÛŒØ³Øª
refreshUnCountriesList();

// Ù‡Ø± Ø²Ù…Ø§Ù† ownership ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ØŒ Ù„ÛŒØ³Øª Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ù†ÛŒÙ… (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
if (window.socket) {
    window.socket.on('ownership_updated', refreshUnCountriesList);
}
</script>