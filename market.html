<div style="padding: 20px;">
    <h2 style="color: #fbbf24; margin-bottom: 30px;">ğŸ’° Ø¨Ø§Ø²Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ Ù†ÙØª</h2>
    
    <!-- Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ù…ÙˆÙ‚Øª -->
    <div id="marketMessage" style="text-align:center; color:#fbbf24; margin-bottom:10px; min-height:24px; transition:opacity 0.3s;"></div>
    
    <div style="background: linear-gradient(135deg, #1e293b, #2d3a4e); padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px;">
        <div style="font-size: 48px; color: #fbbf24; margin-bottom: 10px;" id="oilPrice">100</div>
        <div style="font-size: 18px; color: #94a3b8;">Ù‚ÛŒÙ…Øª Ù‡Ø± Ø¨Ø´Ú©Ù‡ (Ø·Ù„Ø§)</div>
        <div style="margin-top: 15px; color: #4ade80;" id="priceTrend">âš– Ø«Ø§Ø¨Øª</div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
        <div style="background: #1e293b; padding: 15px; border-radius: 12px;">
            <div style="color: #94a3b8;">Ø¹Ø±Ø¶Ù‡ Ø¬Ù‡Ø§Ù†ÛŒ</div>
            <div style="font-size: 24px; color: #fbbf24;" id="globalSupply">1000</div>
        </div>
        <div style="background: #1e293b; padding: 15px; border-radius: 12px;">
            <div style="color: #94a3b8;">Ø±ÙˆÛŒØ¯Ø§Ø¯</div>
            <div style="font-size: 18px; color: #4ade80;" id="globalEvent">Ø¹Ø§Ø¯ÛŒ</div>
        </div>
    </div>

    <!-- ÙˆØ¶Ø¹ÛŒØª Ù…Ù†Ø§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒÚ©Ù† -->
    <div style="background: #1e293b; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; color: #94a3b8;">
            <span>ğŸ›¢ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù†ÙØª: <span id="oilAmount" style="color:#fbbf24;">0</span> Ø¨Ø´Ú©Ù‡</span>
            <span>ğŸª™ Ø·Ù„Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯: <span id="goldAmount" style="color:#4ade80;">0</span></span>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ ÙØ±ÙˆØ´ Ù†ÙØª -->
    <div style="background: #1e293b; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
        <h3 style="color: white; margin-bottom: 20px;">ğŸ’° ÙØ±ÙˆØ´ Ù†ÙØª</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button onclick="sellOil(10)" style="background: #16a34a;" id="sell10">ÙØ±ÙˆØ´ Û±Û° Ù†ÙØª</button>
            <button onclick="sellOil(50)" style="background: #16a34a;" id="sell50">ÙØ±ÙˆØ´ ÛµÛ° Ù†ÙØª</button>
            <button onclick="sellOil(100)" style="background: #16a34a;" id="sell100">ÙØ±ÙˆØ´ Û±Û°Û° Ù†ÙØª</button>
            <button onclick="sellOil(500)" style="background: #16a34a;" id="sell500">ÙØ±ÙˆØ´ ÛµÛ°Û° Ù†ÙØª</button>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Ø®Ø±ÛŒØ¯ Ù†ÙØª -->
    <div style="background: #1e293b; padding: 20px; border-radius: 15px;">
        <h3 style="color: white; margin-bottom: 20px;">ğŸ›¢ Ø®Ø±ÛŒØ¯ Ù†ÙØª</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button onclick="buyOil(10)" style="background: #2563eb;" id="buy10">Ø®Ø±ÛŒØ¯ Û±Û° Ù†ÙØª</button>
            <button onclick="buyOil(50)" style="background: #2563eb;" id="buy50">Ø®Ø±ÛŒØ¯ ÛµÛ° Ù†ÙØª</button>
            <button onclick="buyOil(100)" style="background: #2563eb;" id="buy100">Ø®Ø±ÛŒØ¯ Û±Û°Û° Ù†ÙØª</button>
            <button onclick="buyOil(500)" style="background: #2563eb;" id="buy500">Ø®Ø±ÛŒØ¯ ÛµÛ°Û° Ù†ÙØª</button>
        </div>
    </div>
</div>

<script>
// ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø±ÙˆÙ† ØµÙØ­Ù‡
function showMessage(text, isError = false) {
    const box = document.getElementById('marketMessage');
    box.textContent = text;
    box.style.color = isError ? '#f87171' : '#fbbf24';
    box.style.opacity = '1';
    setTimeout(() => { box.style.opacity = '0'; }, 2500);
}

// ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ù‚ÛŒÙ…Øª
function updateMarketUI() {
    try {
        if (!geoWarSave) return;
        
        // Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ø§Ø¨Ø¹
        document.getElementById('oilAmount').innerText = Math.floor(geoWarSave.resources.oil);
        document.getElementById('goldAmount').innerText = Math.floor(geoWarSave.resources.gold);
        
        // Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²Ø§Ø±
        document.getElementById('oilPrice').innerText = geoWarSave.market?.oilPrice || 100;
        document.getElementById('globalSupply').innerText = geoWarSave.market?.globalSupply || 1000;
        document.getElementById('globalEvent').innerText = geoWarSave.market?.event || 'Ø¹Ø§Ø¯ÛŒ';
        
        const trend = geoWarSave.market?.trend || 'âš–';
        document.getElementById('priceTrend').innerText = trend + ' ' + 
            (trend === 'ğŸ“ˆ' ? 'ØµØ¹ÙˆØ¯ÛŒ' : trend === 'ğŸ“‰' ? 'Ù†Ø²ÙˆÙ„ÛŒ' : 'Ø«Ø§Ø¨Øª');
        
        const price = geoWarSave.market?.oilPrice || 100;
        
        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´: Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†ÙØª Ú©Ø§ÙÛŒ
        document.getElementById('sell10').disabled = geoWarSave.resources.oil < 10;
        document.getElementById('sell50').disabled = geoWarSave.resources.oil < 50;
        document.getElementById('sell100').disabled = geoWarSave.resources.oil < 100;
        document.getElementById('sell500').disabled = geoWarSave.resources.oil < 500;
        
        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯: Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø·Ù„Ø§ÛŒ Ú©Ø§ÙÛŒ
        const costFor10 = Math.floor(10 * price / 10);
        const costFor50 = Math.floor(50 * price / 10);
        const costFor100 = Math.floor(100 * price / 10);
        const costFor500 = Math.floor(500 * price / 10);
        
        document.getElementById('buy10').disabled = geoWarSave.resources.gold < costFor10;
        document.getElementById('buy50').disabled = geoWarSave.resources.gold < costFor50;
        document.getElementById('buy100').disabled = geoWarSave.resources.gold < costFor100;
        document.getElementById('buy500').disabled = geoWarSave.resources.gold < costFor500;
    } catch (e) {
        showMessage("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: " + e.message, true);
    }
}

// ØªØ§Ø¨Ø¹ ÙØ±ÙˆØ´ Ù†ÙØª
function sellOil(amount) {
    try {
        if (!geoWarSave) {
            showMessage("Ø®Ø·Ø§: Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯", true);
            return;
        }
        
        if (geoWarSave.resources.oil < amount) {
            showMessage("âŒ Ù†ÙØª Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!", true);
            return;
        }
        
        let price = geoWarSave.market.oilPrice;
        let income = amount * price / 10;
        
        geoWarSave.resources.oil -= amount;
        geoWarSave.resources.gold += Math.floor(income);
        
        if (window.saveGame) window.saveGame();
        if (window.updateUI) window.updateUI();
        updateMarketUI();
        
        // Ù†Ù…Ø§ÛŒØ´ Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
        let newOil = document.getElementById('oilAmount').innerText;
        showMessage(`ğŸ’° ${amount} Ù†ÙØª ÙØ±ÙˆØ®ØªÙ‡ Ø´Ø¯! +${Math.floor(income)} Ø·Ù„Ø§ (Ù†ÙØª ÙØ¹Ù„ÛŒ: ${newOil})`);
    } catch (e) {
        showMessage("Ø®Ø·Ø§ Ø¯Ø± ÙØ±ÙˆØ´: " + e.message, true);
    }
}

// ØªØ§Ø¨Ø¹ Ø®Ø±ÛŒØ¯ Ù†ÙØª
function buyOil(amount) {
    try {
        if (!geoWarSave) {
            showMessage("Ø®Ø·Ø§: Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯", true);
            return;
        }
        
        let price = geoWarSave.market.oilPrice;
        let cost = Math.floor(amount * price / 10);
        
        if (geoWarSave.resources.gold < cost) {
            showMessage("âŒ Ø·Ù„Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!", true);
            return;
        }
        
        geoWarSave.resources.gold -= cost;
        geoWarSave.resources.oil += amount;
        
        if (window.saveGame) window.saveGame();
        if (window.updateUI) window.updateUI();
        updateMarketUI();
        
        let newGold = document.getElementById('goldAmount').innerText;
        showMessage(`ğŸ›¢ ${amount} Ù†ÙØª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯! -${cost} Ø·Ù„Ø§ (Ø·Ù„Ø§ÛŒ ÙØ¹Ù„ÛŒ: ${newGold})`);
    } catch (e) {
        showMessage("Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÛŒØ¯: " + e.message, true);
    }
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§Ø²Ø§Ø± (ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª ØªØµØ§Ø¯ÙÛŒ)
function updateMarket() {
    try {
        if (!geoWarSave || !geoWarSave.market) return;
        
        let supply = geoWarSave.market.globalSupply;
        let demand = 1000 + Math.random() * 200 - 100;
        
        let events = ["Ø¹Ø§Ø¯ÛŒ", "Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ", "Ø¨Ø­Ø±Ø§Ù† Ù†ÙØª", "ØªÙˆØ§ÙÙ‚ Ø§ÙˆÙ¾Ú©", "Ø±Ú©ÙˆØ¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ"];
        let event = events[Math.floor(Math.random() * events.length)];
        
        let priceChange = (demand - supply) / 100;
        let trendIcon = "âš–";
        
        if (event === "Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ") { priceChange += 50; trendIcon = "ğŸ“ˆ"; }
        if (event === "Ø¨Ø­Ø±Ø§Ù† Ù†ÙØª") { priceChange += 80; trendIcon = "ğŸ“ˆ"; }
        if (event === "ØªÙˆØ§ÙÙ‚ Ø§ÙˆÙ¾Ú©") { priceChange += 30; trendIcon = "ğŸ“ˆ"; }
        if (event === "Ø±Ú©ÙˆØ¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ") { priceChange -= 40; trendIcon = "ğŸ“‰"; }
        
        geoWarSave.market.oilPrice = Math.max(30, Math.min(300, geoWarSave.market.oilPrice + priceChange));
        geoWarSave.market.globalSupply = Math.floor(800 + Math.random() * 400);
        geoWarSave.market.event = event;
        geoWarSave.market.trend = trendIcon;
        
        updateMarketUI();
    } catch (e) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§Ø²Ø§Ø±:", e);
    }
}

// Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
updateMarketUI();
// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§Ø²Ø§Ø± Ù‡Ø± Û±Û° Ø«Ø§Ù†ÛŒÙ‡
setInterval(updateMarket, 10000);
</script>

<style>
/* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ */
button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #4b5563 !important;
}
button {
    transition: 0.2s;
    border: none;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
}
button:hover:not(:disabled) {
    transform: scale(1.02);
    filter: brightness(1.1);
}
</style>