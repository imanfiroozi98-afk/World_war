<div style="padding: 20px;">
    <h2 style="color: #fbbf24; margin-bottom: 20px;">ğŸ“¢ Ø¨ÛŒÙ„Ø¨ÙˆØ±Ø¯ Ø¬Ù‡Ø§Ù†ÛŒ</h2>
    
    <!-- ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ø¨ÛŒØ§Ù†ÛŒÙ‡ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ ØªØ­Øª Ù…Ø§Ù„Ú©ÛŒØª) -->
    <div id="bulletinForm" style="background: #1e293b; border-radius: 15px; padding: 20px; margin-bottom: 20px; display: none;">
        <h3 style="color: #60a5fa; margin-bottom: 15px;">Ø§Ø±Ø³Ø§Ù„ Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø±Ø³Ù…ÛŒ</h3>
        <div style="margin-bottom: 10px;">
            <span>Ú©Ø´ÙˆØ±: <span id="myCountryName"></span></span>
        </div>
        <div style="margin-bottom: 10px;">
            <textarea id="bulletinMessage" rows="3" style="width:100%; background:#0f172a; color:white; border:1px solid #3b82f6; border-radius:8px; padding:10px;" placeholder="Ù…ØªÙ† Ø¨ÛŒØ§Ù†ÛŒÙ‡..."></textarea>
        </div>
        <button onclick="postBulletin()" style="background: #2563eb; border:none; color:white; padding:10px 20px; border-radius:8px; cursor:pointer;">Ø§Ø±Ø³Ø§Ù„</button>
        <span id="bulletinError" style="color:#f87171; margin-left:10px;"></span>
    </div>

    <!-- Ù„ÛŒØ³Øª Ø¨ÛŒØ§Ù†ÛŒÙ‡â€ŒÙ‡Ø§ -->
    <div id="bulletinsList" style="background: #1e293b; border-radius: 15px; padding: 20px; max-height: 400px; overflow-y: auto;">
        <!-- Ø¨ÛŒØ§Ù†ÛŒÙ‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>
</div>

<script>
let currentUserCountry = null;

// Ø¯Ø±ÛŒØ§ÙØª Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² gameState (Ú©Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ geoWarSave Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª)
if (window.geoWarSave && window.geoWarSave.myCountry) {
    currentUserCountry = window.geoWarSave.myCountry;
}

// Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… ÙÙ‚Ø· Ø§Ú¯Ø± Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ…
if (currentUserCountry) {
    document.getElementById('bulletinForm').style.display = 'block';
    document.getElementById('myCountryName').innerText = currentUserCountry;
} else {
    document.getElementById('bulletinForm').style.display = 'none';
}

// ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ø¨ÛŒØ§Ù†ÛŒÙ‡
function postBulletin() {
    const message = document.getElementById('bulletinMessage').value.trim();
    if (!message) {
        document.getElementById('bulletinError').innerText = 'Ù…ØªÙ† Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯';
        return;
    }
    if (!window.socket) {
        document.getElementById('bulletinError').innerText = 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª';
        return;
    }
    window.socket.emit('send_bulletin', { country: currentUserCountry, message });
    document.getElementById('bulletinMessage').value = '';
    document.getElementById('bulletinError').innerText = '';
}

// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† ÛŒÚ© Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø¨Ù‡ Ù„ÛŒØ³Øª
function addBulletinToUI(bulletin) {
    const list = document.getElementById('bulletinsList');
    const item = document.createElement('div');
    item.style.background = '#0f172a';
    item.style.borderRadius = '10px';
    item.style.padding = '15px';
    item.style.marginBottom = '10px';
    item.style.border = '1px solid #334155';
    
    const time = new Date(bulletin.time).toLocaleString('fa-IR');
    item.innerHTML = `
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
            <span style="color:#fbbf24; font-weight:bold;">${bulletin.country}</span>
            <span style="color:#94a3b8; font-size:12px;">${time}</span>
        </div>
        <div style="color:white;">${bulletin.message}</div>
    `;
    list.appendChild(item);
    list.scrollTop = list.scrollHeight;
}

// Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
function loadBulletins(bulletins) {
    const list = document.getElementById('bulletinsList');
    list.innerHTML = '';
    bulletins.forEach(b => addBulletinToUI(b));
}

// Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ socket
if (window.socket) {
    window.socket.on('new_bulletin', (bulletin) => {
        addBulletinToUI(bulletin);
    });
    window.socket.on('bulletins_update', (bulletins) => {
        loadBulletins(bulletins);
    });
}
</script>

<style>
#bulletinsList::-webkit-scrollbar { width: 6px; }
#bulletinsList::-webkit-scrollbar-track { background: #1e293b; }
#bulletinsList::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
</style>